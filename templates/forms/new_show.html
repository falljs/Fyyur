{% extends 'layouts/main.html' %}
{% block title %}New Show Listing{% endblock %}
{% block content %}
  <div class="form-wrapper">
    <form id="show_form" class="form">
      <h3 class="form-heading">List a new show</h3>
      <div class="form-group">
        <label for="artist_id">Artist ID</label>
        <small>ID can be found on the Artist's Page</small>
        <!-- {{ form.artist_id(class_ = 'form-control', autofocus = true) }} -->
        <!-- <input type="" id="artist_id" autofocus class="form-control"> -->
        <select class="form-control">
          {%for artist in artists %} 
          <option id="artist_id" value="{{artist.id}}">{{artist.id}} : {{artist.name}}</option>
          {% endfor %} 
        </select>
      </div>
      <div class="form-group">
        <label for="venue_id">Venue ID</label>
        <small>ID can be found on the Venue's Page</small>
        <!-- <input type="text" id="venue_id" class="form-control"> -->
        <!-- {{ form.venue_id(class_ = 'form-control', autofocus = true) }} -->
        <select class="form-control">
          {%for venue in venues %} 
          <option id="venue_id"  value="{{venue.id}}">{{venue.id}} : {{venue.name}}</option>
          {% endfor %}
        </select>
        
      </div>
      <div class="form-group">
          <label for="start_time">Start Time</label>
          <input type="text" id="start_time" placeholder='YYYY-MM-DD HH:MM' class="form-control">
          <!-- {{ form.start_time(class_ = 'form-control', placeholder='YYYY-MM-DD HH:MM', autofocus = true) }} -->
        </div>
      <input type="submit" value="Create Venue" class="btn btn-primary btn-lg btn-block">
    </form>
    <span id="error" class="hidden" style="color: #FF0000;">Erreur!</span>
    <span id="success" class="hidden">Saved!<a href="http://127.0.0.1:5000/shows">return to show list</a></span>
    <script>
      // ADD Show
      document.getElementById('show_form').onsubmit = function(e) {
        e.preventDefault();
          fetch('/shows/create', {
            method : 'POST',
            body: JSON.stringify({
              'artist_id': document.getElementById('artist_id').value,
              'venue_id': document.getElementById('venue_id').value,
              'start_time': document.getElementById('start_time').value
            }),
            headers: {
              'content-Type': 'application/json'
            }
          })
          .then(function(response) {
            return response.json();
          })
          .then(function(jsonResponse) {
            console.log(jsonResponse)
            document.getElementById('error').className = 'hidden';
            document.getElementById('success').className = '';
          })
          .catch(function() {
            document.getElementById('error').className = '';
            document.getElementById('success').className = 'hidden';
          })
      }
    </script>
  </div>
{% endblock %}